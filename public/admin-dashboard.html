<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - VIT Placement System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="admin-dashboard.html">
                <i class="fas fa-graduation-cap me-2"></i>VIT Placement System
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="admin-dashboard.html">
                            <i class="fas fa-tachometer-alt me-1"></i> Dashboard
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle me-1"></i> <span id="adminName">Admin</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="#" id="changePasswordBtn"><i class="fas fa-key me-2"></i>Change Password</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-2 d-none d-lg-block p-0">
                <div class="admin-sidebar h-100">
                    <div class="d-flex align-items-center mb-4 p-3">
                        <i class="fas fa-user-shield fa-2x text-primary me-3"></i>
                        <div>
                            <h6 class="mb-0 fw-bold">Admin Panel</h6>
                            <small class="text-muted">Manage Placements</small>
                        </div>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#dashboard-section" data-section="dashboard-section">
                                <i class="fas fa-tachometer-alt me-2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#companies-section" data-section="companies-section">
                                <i class="fas fa-building me-2"></i> Companies
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#students-section" data-section="students-section">
                                <i class="fas fa-user-graduate me-2"></i> Students
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#applications-section" data-section="applications-section">
                                <i class="fas fa-clipboard-list me-2"></i> Applications
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#statistics-section" data-section="statistics-section">
                                <i class="fas fa-chart-bar me-2"></i> Statistics
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-10 p-4 bg-light">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="section-content">
                    <h2 class="mb-4"><i class="fas fa-tachometer-alt me-2"></i>Dashboard Overview</h2>
                    
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="stat-card primary">
                                <div class="stat-icon">
                                    <i class="fas fa-user-graduate"></i>
                                </div>
                                <div class="stat-value" id="totalStudents">0</div>
                                <div class="stat-label">Total Students</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card success">
                                <div class="stat-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stat-value" id="placedStudents">0</div>
                                <div class="stat-label">Placed Students</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card secondary">
                                <div class="stat-icon">
                                    <i class="fas fa-building"></i>
                                </div>
                                <div class="stat-value" id="totalCompanies">0</div>
                                <div class="stat-label">Total Companies</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card warning">
                                <div class="stat-icon">
                                    <i class="fas fa-clipboard-list"></i>
                                </div>
                                <div class="stat-value" id="totalApplications">0</div>
                                <div class="stat-label">Total Applications</div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Application Status</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="applicationStatusChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Placement by Course</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="placementByCourseChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Recent Applications</h5>
                            <a href="#applications-section" class="btn btn-sm btn-primary view-all-btn" data-section="applications-section">View All</a>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Student</th>
                                            <th>Company</th>
                                            <th>Position</th>
                                            <th>Applied Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentApplicationsTable">
                                        <tr>
                                            <td colspan="6" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Companies Section -->
                <div id="companies-section" class="section-content d-none">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fas fa-building me-2"></i>Companies Management</h2>
                        <button class="btn btn-primary" id="addCompanyBtn">
                            <i class="fas fa-plus me-2"></i>Add Company
                        </button>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-0"><i class="fas fa-list me-2"></i>Companies List</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" id="searchCompany" placeholder="Search companies...">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Company Name</th>
                                            <th>Industry</th>
                                            <th>Location</th>
                                            <th>Positions</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="companiesTable">
                                        <tr>
                                            <td colspan="5" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Students Section -->
                <div id="students-section" class="section-content d-none">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fas fa-user-graduate me-2"></i>Students Management</h2>
                        <button class="btn btn-primary" id="exportStudentsBtn">
                            <i class="fas fa-file-export me-2"></i>Export Data
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-0"><i class="fas fa-list me-2"></i>Students List</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" id="searchStudent" placeholder="Search students...">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Roll Number</th>
                                            <th>Name</th>
                                            <th>Course</th>
                                            <th>Branch</th>
                                            <th>Year</th>
                                            <th>CGPA</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="studentsTable">
                                        <tr>
                                            <td colspan="7" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Applications Section -->
                <div id="applications-section" class="section-content d-none">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fas fa-clipboard-list me-2"></i>Applications Management</h2>
                        <div class="d-flex gap-2">
                            <select class="form-select" id="statusFilter">
                                <option value="">All Statuses</option>
                                <option value="pending">Pending</option>
                                <option value="interview">Interview</option>
                                <option value="accepted">Accepted</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <button class="btn btn-primary" id="exportApplicationsBtn">
                                <i class="fas fa-file-export me-2"></i>Export Data
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-0"><i class="fas fa-list me-2"></i>Applications List</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" id="searchApplication" placeholder="Search applications...">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Student</th>
                                            <th>Company</th>
                                            <th>Position</th>
                                            <th>Applied Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="applicationsTable">
                                        <tr>
                                            <td colspan="6" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Section -->
                <div id="statistics-section" class="section-content d-none">
                    <h2 class="mb-4"><i class="fas fa-chart-bar me-2"></i>Placement Statistics</h2>
                    
                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Placement Rate</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="placementRateChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Applications by Status</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="applicationStatusDetailChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Placement by Branch</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="placementByBranchChart" height="300"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-table me-2"></i>Placement Summary</h5>
                            <button class="btn btn-primary" id="generateReportBtn">
                                <i class="fas fa-file-pdf me-2"></i>Generate Report
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Course</th>
                                            <th>Total Students</th>
                                            <th>Placed Students</th>
                                            <th>Placement Percentage</th>
                                            <th>Highest CTC</th>
                                            <th>Average CTC</th>
                                        </tr>
                                    </thead>
                                    <tbody id="courseSummaryTable">
                                        <tr>
                                            <td colspan="6" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot class="table-light" id="totalSummaryRow">
                                        <tr>
                                            <th>Total</th>
                                            <th>0</th>
                                            <th>0</th>
                                            <th>0%</th>
                                            <th>₹0 LPA</th>
                                            <th>₹0 LPA</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Company Modal -->
    <div class="modal fade" id="companyModal" tabindex="-1" aria-labelledby="companyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="companyModalLabel">
                        <i class="fas fa-building me-2"></i><span id="companyModalTitle">Add Company</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="companyForm" class="needs-validation" novalidate>
                        <input type="hidden" id="companyId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="companyName" class="form-label">Company Name</label>
                                <input type="text" class="form-control" id="companyName" required>
                                <div class="invalid-feedback">Company name is required.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="industry" class="form-label">Industry</label>
                                <input type="text" class="form-control" id="industry" required>
                                <div class="invalid-feedback">Industry is required.</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="location" class="form-label">Location</label>
                                <input type="text" class="form-control" id="location" required>
                                <div class="invalid-feedback">Location is required.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="website" class="form-label">Website</label>
                                <input type="url" class="form-control" id="website">
                                <div class="invalid-feedback">Please enter a valid URL.</div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" rows="3" required></textarea>
                            <div class="invalid-feedback">Description is required.</div>
                        </div>
                        
                        <h5 class="mt-4 mb-3"><i class="fas fa-briefcase me-2"></i>Job Positions</h5>
                        <div id="positionsContainer">
                            <!-- Positions will be added here dynamically -->
                        </div>
                        
                        <div class="d-grid mt-3">
                            <button type="button" class="btn btn-outline-primary" id="addPositionBtn">
                                <i class="fas fa-plus me-2"></i>Add Position
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveCompanyBtn">
                        <span class="spinner-border spinner-border-sm d-none me-2" role="status" aria-hidden="true"></span>
                        Save Company
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Application Status Modal -->
    <div class="modal fade" id="updateStatusModal" tabindex="-1" aria-labelledby="updateStatusModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="updateStatusModalLabel">
                        <i class="fas fa-edit me-2"></i>Update Application Status
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="statusForm" class="needs-validation" novalidate>
                        <input type="hidden" id="applicationId">
                        <div class="mb-3">
                            <label for="applicationStatus" class="form-label">Status</label>
                            <select class="form-select" id="applicationStatus" required>
                                <option value="pending">Pending</option>
                                <option value="interview">Interview Scheduled</option>
                                <option value="accepted">Accepted</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <div class="invalid-feedback">Please select a status.</div>
                        </div>
                        
                        <div id="interviewFields" class="d-none">
                            <div class="mb-3">
                                <label for="interviewDate" class="form-label">Interview Date</label>
                                <input type="date" class="form-control" id="interviewDate">
                                <div class="invalid-feedback">Please select an interview date.</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="interviewTime" class="form-label">Interview Time</label>
                                <input type="time" class="form-control" id="interviewTime">
                                <div class="invalid-feedback">Please select an interview time.</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="interviewLocation" class="form-label">Interview Location</label>
                                <input type="text" class="form-control" id="interviewLocation">
                                <div class="invalid-feedback">Please enter an interview location.</div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="notes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveStatusBtn">
                        <span class="spinner-border spinner-border-sm d-none me-2" role="status" aria-hidden="true"></span>
                        Update Status
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Student Modal -->
    <div class="modal fade" id="viewStudentModal" tabindex="-1" aria-labelledby="viewStudentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewStudentModalLabel">
                        <i class="fas fa-user-graduate me-2"></i>Student Details
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="studentDetails">
                        <div class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="changePasswordModalLabel">
                        <i class="fas fa-key me-2"></i>Change Password
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="changePasswordAlert" class="alert alert-danger d-none"></div>
                    <form id="changePasswordForm" class="needs-validation" novalidate>
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input type="password" class="form-control" id="currentPassword" required>
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="invalid-feedback">Current password is required.</div>
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input type="password" class="form-control" id="newPassword" required minlength="6">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text">Password must be at least 6 characters long.</div>
                            <div class="invalid-feedback">New password must be at least 6 characters long.</div>
                        </div>
                        <div class="mb-3">
                            <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input type="password" class="form-control" id="confirmNewPassword" required>
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="invalid-feedback" id="passwordMatchError">Passwords do not match.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="changePasswordSubmit">
                        <span class="spinner-border spinner-border-sm d-none me-2" role="status" aria-hidden="true"></span>
                        Update Password
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function() {
            // Check if user is logged in as admin
            const token = localStorage.getItem('token');
            const role = localStorage.getItem('role');
            
            if (!token || role !== 'admin') {
                window.location.href = 'login.html';
                return;
            }
            
            // Set admin name
            $('#adminName').text(localStorage.getItem('name') || 'Admin');
            
            // Toggle password visibility
            $('.toggle-password').click(function() {
                const passwordField = $(this).siblings('input');
                const icon = $(this).find('i');
                
                if (passwordField.attr('type') === 'password') {
                    passwordField.attr('type', 'text');
                    icon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    passwordField.attr('type', 'password');
                    icon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });
            
            // Navigation
            $('.nav-link[data-section]').click(function(e) {
                e.preventDefault();
                
                const sectionId = $(this).attr('data-section');
                
                // Hide all sections
                $('.section-content').addClass('d-none');
                
                // Show selected section
                $(`#${sectionId}`).removeClass('d-none');
                
                // Update active state
                $('.nav-link').removeClass('active');
                $(this).addClass('active');
                
                // Load section data if needed
                if (sectionId === 'companies-section') {
                    loadCompanies();
                } else if (sectionId === 'students-section') {
                    loadStudents();
                } else if (sectionId === 'applications-section') {
                    loadApplications();
                } else if (sectionId === 'statistics-section') {
                    loadStatistics();
                }
            });
            
            // View All buttons
            $('.view-all-btn').click(function(e) {
                e.preventDefault();
                
                const sectionId = $(this).data('section');
                $(`.nav-link[data-section="${sectionId}"]`).click();
            });
            
            // Load dashboard data
            function loadDashboardData() {
                $.ajax({
                    url: '/api/admin/statistics',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    success: function(response) {
                        // Update stats
                        $('#totalStudents').text(response.totalStudents || 0);
                        $('#placedStudents').text(response.placedStudents || 0);
                        $('#totalCompanies').text(response.totalCompanies || 0);
                        $('#totalApplications').text(response.totalApplications || 0);
                        
                        // Initialize charts
                        initCharts(response);
                        
                        // Load recent applications
                        loadRecentApplications();
                    },
                    error: function(xhr) {
                        console.error('Failed to load statistics:', xhr.responseJSON);
                    }
                });
            }
            
            // Load recent applications
            function loadRecentApplications() {
                $.ajax({
                    url: '/api/admin/applications',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    success: function(response) {
                        const applications = response.applications;
                        
                        if (!applications || applications.length === 0) {
                            $('#recentApplicationsTable').html('<tr><td colspan="6" class="text-center">No applications found.</td></tr>');
                            return;
                        }
                        
                        // Get 5 most recent applications
                        const recentApplications = applications.slice(0, 5);
                        
                        let html = '';
                        recentApplications.forEach(app => {
                            const studentName = app.user ? `${app.user.firstName} ${app.user.lastName}` : 'Unknown';
                            const companyName = app.company ? app.company.name : 'Unknown';
                            
                            html += `
                                <tr>
                                    <td>${studentName}</td>
                                    <td>${companyName}</td>
                                    <td>${app.position}</td>
                                    <td>${new Date(app.appliedDate).toLocaleDateString()}</td>
                                    <td>
                                        <span class="badge ${getBadgeClass(app.status)}">${capitalizeFirstLetter(app.status)}</span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-primary update-status-btn" data-id="${app._id}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                            `;
                        });
                        
                        $('#recentApplicationsTable').html(html);
                    },
                    error: function(xhr) {
                        console.error('Failed to load applications:', xhr.responseJSON);
                        $('#recentApplicationsTable').html('<tr><td colspan="6" class="text-center text-danger">Failed to load applications.</td></tr>');
                    }
                });
            }
            
            // Load companies
            function loadCompanies() {
                $('#companiesTable').html(`
                    <tr>
                        <td colspan="5" class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </td>
                    </tr>
                `);
                
                $.ajax({
                    url: '/api/admin/companies',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    success: function(response) {
                        const companies = response.companies;
                        
                        if (!companies || companies.length === 0) {
                            $('#companiesTable').html('<tr><td colspan="5" class="text-center">No companies found.</td></tr>');
                            return;
                        }
                        
                        let html = '';
                        companies.forEach(company => {
                            html += `
                                <tr>
                                    <td>${company.name}</td>
                                    <td>${company.industry}</td>
                                    <td>${company.location}</td>
                                    <td>${company.positions ? company.positions.length : 0}</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary view-company-btn me-1" data-id="${company._id}">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning edit-company-btn me-1" data-id="${company._id}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger delete-company-btn" data-id="${company._id}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            `;
                        });
                        
                        $('#companiesTable').html(html);
                    },
                    error: function(xhr) {
                        console.error('Failed to load companies:', xhr.responseJSON);
                        $('#companiesTable').html('<tr><td colspan="5" class="text-center text-danger">Failed to load companies.</td></tr>');
                    }
                });
            }
            
            // Load students
            function loadStudents() {
                $('#studentsTable').html(`
                    <tr>
                        <td colspan="7" class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </td>
                    </tr>
                `);
                
                $.ajax({
                    url: '/api/admin/students',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    success: function(response) {
                        const students = response.students;
                        
                        if (!students || students.length === 0) {
                            $('#studentsTable').html('<tr><td colspan="7" class="text-center">No students found.</td></tr>');
                            return;
                        }
                        
                        let html = '';
                        students.forEach(student => {
                            html += `
                                <tr>
                                    <td>${student.rollNumber}</td>
                                    <td>${student.firstName} ${student.lastName}</td>
                                    <td>${student.course}</td>
                                    <td>${student.branch}</td>
                                    <td>${student.year}</td>
                                    <td>${student.cgpa}</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary view-student-btn" data-id="${student._id}">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning edit-student-btn" data-id="${student._id}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                            `;
                        });
                        
                        $('#studentsTable').html(html);
                    },
                    error: function(xhr) {
                        console.error('Failed to load students:', xhr.responseJSON);
                        $('#studentsTable').html('<tr><td colspan="7" class="text-center text-danger">Failed to load students.</td></tr>');
                    }
                });
            }
            
            // Load applications
            function loadApplications() {
                $('#applicationsTable').html(`
                    <tr>
                        <td colspan="6" class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </td>
                    </tr>
                `);
                
                $.ajax({
                    url: '/api/admin/applications',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    success: function(response) {
                        const applications = response.applications;
                        
                        if (!applications || applications.length === 0) {
                            $('#applicationsTable').html('<tr><td colspan="6" class="text-center">No applications found.</td></tr>');
                            return;
                        }
                        
                        let html = '';
                        applications.forEach(app => {
                            const studentName = app.user ? `${app.user.firstName} ${app.user.lastName}` : 'Unknown';
                            const companyName = app.company ? app.company.name : 'Unknown';
                            
                            html += `
                                <tr>
                                    <td>${studentName}</td>
                                    <td>${companyName}</td>
                                    <td>${app.position}</td>
                                    <td>${new Date(app.appliedDate).toLocaleDateString()}</td>
                                    <td>
                                        <span class="badge ${getBadgeClass(app.status)}">${capitalizeFirstLetter(app.status)}</span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-primary update-status-btn" data-id="${app._id}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                            `;
                        });
                        
                        $('#applicationsTable').html(html);
                    },
                    error: function(xhr) {
                        console.error('Failed to load applications:', xhr.responseJSON);
                        $('#applicationsTable').html('<tr><td colspan="6" class="text-center text-danger">Failed to load applications.</td></tr>');
                    }
                });
            }
            
            // Load statistics
            function loadStatistics() {
                $.ajax({
                    url: '/api/admin/statistics',
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    success: function(response) {
                        // Update course summary table
                        updateCourseSummary(response);
                    },
                    error: function(xhr) {
                        console.error('Failed to load statistics:', xhr.responseJSON);
                    }
                });
            }
            
            // Update course summary table
            function updateCourseSummary(data) {
                // Mock data for demonstration
                const courses = [
                    {
                        name: 'B.Tech',
                        totalStudents: 120,
                        placedStudents: 95,
                        placementPercentage: 79,
                        highestCTC: 25,
                        averageCTC: 12.5
                    },
                    {
                        name: 'M.Tech',
                        totalStudents: 45,
                        placedStudents: 38,
                        placementPercentage: 84,
                        highestCTC: 22,
                        averageCTC: 14.2
                    },
                    {
                        name: 'BCA',
                        totalStudents: 60,
                        placedStudents: 45,
                        placementPercentage: 75,
                        highestCTC: 18,
                        averageCTC: 10.8
                    },
                    {
                        name: 'MCA',
                        totalStudents: 30,
                        placedStudents: 25,
                        placementPercentage: 83,
                        highestCTC: 20,
                        averageCTC: 12.0
                    },
                    {
                        name: 'MBA',
                        totalStudents: 50,
                        placedStudents: 42,
                        placementPercentage: 84,
                        highestCTC: 24,
                        averageCTC: 15.5
                    }
                ];
                
                let html = '';
                let totalStudents = 0;
                let totalPlaced = 0;
                let maxCTC = 0;
                let totalCTC = 0;
                let totalPlacedForAvg = 0;
                
                courses.forEach(course => {
                    html += `
                        <tr>
                            <td>${course.name}</td>
                            <td>${course.totalStudents}</td>
                            <td>${course.placedStudents}</td>
                            <td>${course.placementPercentage}%</td>
                            <td>₹${course.highestCTC} LPA</td>
                            <td>₹${course.averageCTC} LPA</td>
                        </tr>
                    `;
                    
                    totalStudents += course.totalStudents;
                    totalPlaced += course.placedStudents;
                    maxCTC = Math.max(maxCTC, course.highestCTC);
                    totalCTC += course.averageCTC * course.placedStudents;
                    totalPlacedForAvg += course.placedStudents;
                });
                
                $('#courseSummaryTable').html(html);
                
                // Update total summary row
                const placementPercentage = totalStudents > 0 ? Math.round((totalPlaced / totalStudents) * 100) : 0;
                const avgCTC = totalPlacedForAvg > 0 ? (totalCTC / totalPlacedForAvg).toFixed(1) : 0;
                
                $('#totalSummaryRow').html(`
                    <tr>
                        <th>Total</th>
                        <th>${totalStudents}</th>
                        <th>${totalPlaced}</th>
                        <th>${placementPercentage}%</th>
                        <th>₹${maxCTC} LPA</th>
                        <th>₹${avgCTC} LPA</th>
                    </tr>
                `);
            }
            
            // Initialize charts
            function initCharts(data) {
                // Application Status Chart
                const statusCtx = document.getElementById('applicationStatusChart').getContext('2d');
                new Chart(statusCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Pending', 'Interview', 'Accepted', 'Rejected'],
                        datasets: [{
                            data: [
                                data.statusStats?.pending || 0,
                                data.statusStats?.interview || 0,
                                data.statusStats?.accepted || 0,
                                data.statusStats?.rejected || 0
                            ],
                            backgroundColor: [
                                '#ffc107',
                                '#17a2b8',
                                '#28a745',
                                '#dc3545'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
                
                // Placement by Course Chart
                const courseCtx = document.getElementById('placementByCourseChart').getContext('2d');
                new Chart(courseCtx, {
                    type: 'bar',
                    data: {
                        labels: ['B.Tech', 'M.Tech', 'BCA', 'MCA', 'MBA'],
                        datasets: [{
                            label: 'Total Students',
                            data: [120, 45, 60, 30, 50],
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }, {
                            label: 'Placed Students',
                            data: [95, 38, 45, 25, 42],
                            backgroundColor: 'rgba(75, 192, 192, 0.5)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
                
                // Placement Rate Chart
                const rateCtx = document.getElementById('placementRateChart').getContext('2d');
                new Chart(rateCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Placed', 'Not Placed'],
                        datasets: [{
                            data: [data.placedStudents || 0, (data.totalStudents - data.placedStudents) || 0],
                            backgroundColor: [
                                '#28a745',
                                '#dc3545'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
                
                // Application Status Detail Chart
                const statusDetailCtx = document.getElementById('applicationStatusDetailChart').getContext('2d');
                new Chart(statusDetailCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Pending', 'Interview', 'Accepted', 'Rejected'],
                        datasets: [{
                            label: 'Number of Applications',
                            data: [
                                data.statusStats?.pending || 0,
                                data.statusStats?.interview || 0,
                                data.statusStats?.accepted || 0,
                                data.statusStats?.rejected || 0
                            ],
                            backgroundColor: [
                                'rgba(255, 193, 7, 0.5)',
                                'rgba(23, 162, 184, 0.5)',
                                'rgba(40, 167, 69, 0.5)',
                                'rgba(220, 53, 69, 0.5)'
                            ],
                            borderColor: [
                                'rgba(255, 193, 7, 1)',
                                'rgba(23, 162, 184, 1)',
                                'rgba(40, 167, 69, 1)',
                                'rgba(220, 53, 69, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                
                // Placement by Branch Chart
                const branchCtx = document.getElementById('placementByBranchChart').getContext('2d');
                new Chart(branchCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Computer Science', 'Information Technology', 'Electronics', 'Electrical', 'Mechanical', 'Civil'],
                        datasets: [{
                            label: 'Total Students',
                            data: [80, 70, 50, 45, 40, 30],
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }, {
                            label: 'Placed Students',
                            data: [70, 60, 35, 30, 25, 15],
                            backgroundColor: 'rgba(75, 192, 192, 0.5)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            // Add Company
            $('#addCompanyBtn').click(function() {
                // Reset form
                $('#companyForm')[0].reset();
                $('#companyId').val('');
                $('#companyModalTitle').text('Add Company');
                $('#positionsContainer').empty();
                
                // Add initial position
                addPositionField();
                
                // Show modal
                $('#companyModal').modal('show');
            });
            
            // Add Position Field
            function addPositionField(position = null) {
                const positionId = new Date().getTime();
                
                const html = `
                    <div class="card mb-3 position-card" data-position-id="${positionId}">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Position ${$('.position-card').length + 1}</span>
                            <button type="button" class="btn btn-sm btn-outline-danger remove-position-btn">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Title</label>
                                    <input type="text" class="form-control position-title" value="${position ? position.title : ''}" required>
                                    <div class="invalid-feedback">Title is required.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Job Type</label>
                                    <select class="form-select position-job-type" required>
                                        <option value="Full Time" ${position && position.jobType === 'Full Time' ? 'selected' : ''}>Full Time</option>
                                        <option value="Internship" ${position && position.jobType === 'Internship' ? 'selected' : ''}>Internship</option>
                                    </select>
                                    <div class="invalid-feedback">Job type is required.</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">CTC (LPA)</label>
                                    <input type="number" class="form-control position-ctc" value="${position ? position.ctc : ''}" required min="0" step="0.1">
                                    <div class="invalid-feedback">CTC is required.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Last Date to Apply</label>
                                    <input type="date" class="form-control position-last-date" value="${position ? new Date(position.lastDate).toISOString().split('T')[0] : ''}" required>
                                    <div class="invalid-feedback">Last date is required.</div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control position-description" rows="2" required>${position ? position.description : ''}</textarea>
                                <div class="invalid-feedback">Description is required.</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Eligibility</label>
                                <input type="text" class="form-control position-eligibility" value="${position ? position.eligibility : ''}" required>
                                <div class="invalid-feedback">Eligibility is required.</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Skills (comma separated)</label>
                                <input type="text" class="form-control position-skills" value="${position && position.skills ? position.skills.join(', ') : ''}">
                            </div>
                        </div>
                    </div>
                `;
                
                $('#positionsContainer').append(html);
            }
            
            // Add Position Button
            $('#addPositionBtn').click(function() {
                addPositionField();
            });
            
            // Remove Position Button
            $(document).on('click', '.remove-position-btn', function() {
                if ($('.position-card').length > 1) {
                    $(this).closest('.position-card').remove();
                    
                    // Update position numbers
                    $('.position-card').each(function(index) {
                        $(this).find('.card-header span').text(`Position ${index + 1}`);
                    });
                } else {
                    alert('At least one position is required.');
                }
            });
            
            // Save Company
            $('#saveCompanyBtn').click(function() {
                // Validate form
                const form = document.getElementById('companyForm');
                if (!form.checkValidity()) {
                    form.classList.add('was-validated');
                    return;
                }
                
                // Validate positions
                let isValid = true;
                $('.position-card').each(function() {
                    const title = $(this).find('.position-title').val();
                    const jobType = $(this).find('.position-job-type').val();
                    const ctc = $(this).find('.position-ctc').val();
                    const lastDate = $(this).find('.position-last-date').val();
                    const description = $(this).find('.position-description').val();
                    const eligibility = $(this).find('.position-eligibility').val();
                    
                    if (!title || !jobType || !ctc || !lastDate || !description || !eligibility) {
                        isValid = false;
                        return false;
                    }
                });
                
                if (!isValid) {
                    form.classList.add('was-validated');
                    return;
                }
                
                // Show loading spinner
                $('#saveCompanyBtn').attr('disabled', true);
                $('#saveCompanyBtn .spinner-border').removeClass('d-none');
                
                // Prepare company data
                const companyId = $('#companyId').val();
                const companyData = {
                    name: $('#companyName').val(),
                    industry: $('#industry').val(),
                    location: $('#location').val(),
                    website: $('#website').val(),
                    description: $('#description').val(),
                    positions: []
                };
                
                // Add positions
                $('.position-card').each(function() {
                    const skills = $(this).find('.position-skills').val();
                    
                    companyData.positions.push({
                        title: $(this).find('.position-title').val(),
                        jobType: $(this).find('.position-job-type').val(),
                        ctc: parseFloat($(this).find('.position-ctc').val()),
                        lastDate: $(this).find('.position-last-date').val(),
                        description: $(this).find('.position-description').val(),
                        eligibility: $(this).find('.position-eligibility').val(),
                        skills: skills ? skills.split(',').map(skill => skill.trim()) : []
                    });
                });
                
                // AJAX request
                const url = companyId ? `/api/admin/company/${companyId}` : '/api/admin/company';
                const method = companyId ? 'PUT' : 'POST';
                
                $.ajax({
                    url: url,
                    method: method,
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    contentType: 'application/json',
                    data: JSON.stringify(companyData),
                    success: function(response) {
                        // Hide modal
                        $('#companyModal').modal('hide');
                        
                        // Reload companies
                        loadCompanies();
                        
                        // Show success message
                        alert(`Company ${companyId ? 'updated' : 'added'} successfully!`);
                    },
                    error: function(xhr) {
                        const errorMessage = xhr.responseJSON ? xhr.responseJSON.message : `Failed to ${companyId ? 'update' : 'add'} company. Please try again.`;
                        alert(errorMessage);
                    },
                    complete: function() {
                        // Hide loading spinner
                        $('#saveCompanyBtn').attr('disabled', false);
                        $('#saveCompanyBtn .spinner-border').addClass('d-none');
                    }
                });
            });
            
            // Edit Company
            $(document).on('click', '.edit-company-btn', function() {
                const companyId = $(this).data('id');
                
                // Show loading spinner
                $(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                $(this).attr('disabled', true);
                
                // Get company details
                $.ajax({
                    url: `/api/company/${companyId}`,
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    success: function(response) {
                        const company = response.company;
                        
                        // Reset form
                        $('#companyForm')[0].reset();
                        $('#positionsContainer').empty();
                        
                        // Set company data
                        $('#companyId').val(company._id);
                        $('#companyName').val(company.name);
                        $('#industry').val(company.industry);
                        $('#location').val(company.location);
                        $('#website').val(company.website || '');
                        $('#description').val(company.description);
                        
                        // Add positions
                        if (company.positions && company.positions.length > 0) {
                            company.positions.forEach(position => {
                                addPositionField(position);
                            });
                        } else {
                            addPositionField();
                        }
                        
                        // Update modal title
                        $('#companyModalTitle').text('Edit Company');
                        
                        // Show modal
                        $('#companyModal').modal('show');
                    },
                    error: function(xhr) {
                        const errorMessage = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to get company details. Please try again.';
                        alert(errorMessage);
                    },
                    complete: function() {
                        // Reset button
                        $('.edit-company-btn[data-id="' + companyId + '"]').html('<i class="fas fa-edit"></i>');
                        $('.edit-company-btn[data-id="' + companyId + '"]').attr('disabled', false);
                    }
                });
            });
            
            // Delete Company
            $(document).on('click', '.delete-company-btn', function() {
                const companyId = $(this).data('id');
                
                if (confirm('Are you sure you want to delete this company? This action cannot be undone.')) {
                    // Show loading spinner
                    $(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                    $(this).attr('disabled', true);
                    
                    // Delete company
                    $.ajax({
                        url: `/api/admin/company/${companyId}`,
                        method: 'DELETE',
                        headers: {
                            'Authorization': 'Bearer ' + token
                        },
                        success: function() {
                            // Reload companies
                            loadCompanies();
                            
                            // Show success message
                            alert('Company deleted successfully!');
                        },
                        error: function(xhr) {
                            const errorMessage = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to delete company. Please try again.';
                            alert(errorMessage);
                            
                            // Reset button
                            $('.delete-company-btn[data-id="' + companyId + '"]').html('<i class="fas fa-trash"></i>');
                            $('.delete-company-btn[data-id="' + companyId + '"]').attr('disabled', false);
                        }
                    });
                }
            });
            
            // View Student
            $(document).on('click', '.view-student-btn', function() {
                const studentId = $(this).data('id');
                
                // Show loading spinner
                $(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                $(this).attr('disabled', true);
                
                // Get student details
                $.ajax({
                    url: `/api/admin/student/${studentId}`,
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    success: function(response) {
                        const student = response.student;
                        
                        // Prepare student details HTML
                        let html = `
                            <div class="row">
                                <div class="col-md-4 text-center mb-4 mb-md-0">
                                    <img src="/placeholder.svg?height=150&width=150" alt="Profile Picture" class="rounded-circle img-thumbnail mb-3" style="width: 150px; height: 150px;">
                                    <h5>${student.firstName} ${student.lastName}</h5>
                                    <p class="text-muted">${student.rollNumber}</p>
                                </div>
                                <div class="col-md-8">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <h6 class="text-muted">Email</h6>
                                            <p>${student.email}</p>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <h6 class="text-muted">Phone</h6>
                                            <p>${student.phone}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <h6 class="text-muted">Course</h6>
                                            <p>${student.course}</p>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <h6 class="text-muted">Branch</h6>
                                            <p>${student.branch}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <h6 class="text-muted">Year</h6>
                                            <p>${student.year} Year</p>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <h6 class="text-muted">CGPA</h6>
                                            <p>${student.cgpa}</p>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <h6 class="text-muted">Address</h6>
                                        <p>${student.address}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <hr>
                            
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <h6 class="mb-3">Skills</h6>
                                    <div>
                        `;
                        
                        if (student.skills && student.skills.length > 0) {
                            student.skills.forEach(skill => {
                                html += `<span class="badge bg-primary me-2 mb-2">${skill}</span>`;
                            });
                        } else {
                            html += `<p class="text-muted">No skills added yet.</p>`;
                        }
                        
                        html += `
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <h6 class="mb-3">Applications</h6>
                                    <div id="studentApplications">
                                        <div class="text-center">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // Set student details
                        $('#studentDetails').html(html);
                        
                        // Show modal
                        $('#viewStudentModal').modal('show');
                        
                        // Load student applications
                        loadStudentApplications(studentId);
                    },
                    error: function(xhr) {
                        const errorMessage = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to get student details. Please try again.';
                        alert(errorMessage);
                    },
                    complete: function() {
                        // Reset button
                        $('.view-student-btn[data-id="' + studentId + '"]').html('<i class="fas fa-eye"></i>');
                        $('.view-student-btn[data-id="' + studentId + '"]').attr('disabled', false);
                    }
                });
            });
            
            // Load student applications
            function loadStudentApplications(studentId) {
                $.ajax({
                    url: `/api/admin/applications?studentId=${studentId}`,
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    success: function(response) {
                        const applications = response.applications;
                        
                        if (!applications || applications.length === 0) {
                            $('#studentApplications').html('<p class="text-muted">No applications found.</p>');
                            return;
                        }
                        
                        let html = '<div class="list-group">';
                        applications.forEach(app => {
                            const companyName = app.company ? app.company.name : 'Unknown';
                            
                            html += `
                                <div class="list-group-item">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">${companyName}</h6>
                                        <span class="badge ${getBadgeClass(app.status)}">${capitalizeFirstLetter(app.status)}</span>
                                    </div>
                                    <p class="mb-1">${app.position}</p>
                                    <small>Applied: ${new Date(app.appliedDate).toLocaleDateString()}</small>
                                </div>
                            `;
                        });
                        html += '</div>';
                        
                        $('#studentApplications').html(html);
                    },
                    error: function(xhr) {
                        console.error('Failed to load student applications:', xhr.responseJSON);
                        $('#studentApplications').html('<p class="text-danger">Failed to load applications.</p>');
                    }
                });
            }
            
            // Update Application Status
            $(document).on('click', '.update-status-btn', function() {
                const applicationId = $(this).data('id');
                
                // Show loading spinner
                $(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                $(this).attr('disabled', true);
                
                // Get application details
                $.ajax({
                    url: `/api/admin/application/${applicationId}`,
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    success: function(response) {
                        const application = response.application;
                        
                        // Reset form
                        $('#statusForm')[0].reset();
                        
                        // Set application data
                        $('#applicationId').val(application._id);
                        $('#applicationStatus').val(application.status);
                        $('#notes').val(application.notes || '');
                        
                        if (application.status === 'interview') {
                            $('#interviewFields').removeClass('d-none');
                            $('#interviewDate').val(application.interviewDate ? new Date(application.interviewDate).toISOString().split('T')[0] : '');
                            $('#interviewTime').val(application.interviewTime || '');
                            $('#interviewLocation').val(application.interviewLocation || '');
                        } else {
                            $('#interviewFields').addClass('d-none');
                        }
                        
                        // Show modal
                        $('#updateStatusModal').modal('show');
                    },
                    error: function(xhr) {
                        const errorMessage = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to get application details. Please try again.';
                        alert(errorMessage);
                    },
                    complete: function() {
                        // Reset button
                        $('.update-status-btn[data-id="' + applicationId + '"]').html('<i class="fas fa-edit"></i>');
                        $('.update-status-btn[data-id="' + applicationId + '"]').attr('disabled', false);
                    }
                });
            });
            
            // Application Status Change
            $('#applicationStatus').change(function() {
                if ($(this).val() === 'interview') {
                    $('#interviewFields').removeClass('d-none');
                    $('#interviewDate').prop('required', true);
                    $('#interviewTime').prop('required', true);
                    $('#interviewLocation').prop('required', true);
                } else {
                    $('#interviewFields').addClass('d-none');
                    $('#interviewDate').prop('required', false);
                    $('#interviewTime').prop('required', false);
                    $('#interviewLocation').prop('required', false);
                }
            });
            
            // Save Application Status
            $('#saveStatusBtn').click(function() {
                // Validate form
                const form = document.getElementById('statusForm');
                if (!form.checkValidity()) {
                    form.classList.add('was-validated');
                    return;
                }
                
                // Show loading spinner
                $('#saveStatusBtn').attr('disabled', true);
                $('#saveStatusBtn .spinner-border').removeClass('d-none');
                
                // Prepare status data
                const applicationId = $('#applicationId').val();
                const statusData = {
                    status: $('#applicationStatus').val(),
                    notes: $('#notes').val()
                };
                
                if (statusData.status === 'interview') {
                    statusData.interviewDate = $('#interviewDate').val();
                    statusData.interviewTime = $('#interviewTime').val();
                    statusData.interviewLocation = $('#interviewLocation').val();
                }
                
                // AJAX request
                $.ajax({
                    url: `/api/admin/application/${applicationId}`,
                    method: 'PUT',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    contentType: 'application/json',
                    data: JSON.stringify(statusData),
                    success: function() {
                        // Hide modal
                        $('#updateStatusModal').modal('hide');
                        
                        // Reload applications
                        loadApplications();
                        
                        // Reload recent applications
                        loadRecentApplications();
                        
                        // Show success message
                        alert('Application status updated successfully!');
                    },
                    error: function(xhr) {
                        const errorMessage = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to update application status. Please try again.';
                        alert(errorMessage);
                    },
                    complete: function() {
                        // Hide loading spinner
                        $('#saveStatusBtn').attr('disabled', false);
                        $('#saveStatusBtn .spinner-border').addClass('d-none');
                    }
                });
            });
            
            // Change Password
            $('#changePasswordBtn').click(function() {
                // Reset form
                $('#changePasswordForm')[0].reset();
                $('#changePasswordAlert').addClass('d-none');
                
                // Show modal
                $('#changePasswordModal').modal('show');
            });
            
            // Change Password Submit
            $('#changePasswordSubmit').click(function() {
                // Validate form
                const form = document.getElementById('changePasswordForm');
                if (!form.checkValidity()) {
                    form.classList.add('was-validated');
                    return;
                }
                
                // Check if passwords match
                const newPassword = $('#newPassword').val();
                const confirmNewPassword = $('#confirmNewPassword').val();
                
                if (newPassword !== confirmNewPassword) {
                    $('#confirmNewPassword').addClass('is-invalid');
                    $('#passwordMatchError').show();
                    return;
                } else {
                    $('#confirmNewPassword').removeClass('is-invalid');
                    $('#passwordMatchError').hide();
                }
                
                // Show loading spinner
                $('#changePasswordSubmit').attr('disabled', true);
                $('#changePasswordSubmit .spinner-border').removeClass('d-none');
                $('#changePasswordAlert').addClass('d-none');
                
                // AJAX request
                $.ajax({
                    url: '/api/auth/change-password',
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    contentType: 'application/json',
                    data: JSON.stringify({
                        currentPassword: $('#currentPassword').val(),
                        newPassword: newPassword
                    }),
                    success: function() {
                        // Hide modal
                        $('#changePasswordModal').modal('hide');
                        
                        // Show success message
                        alert('Password changed successfully!');
                    },
                    error: function(xhr) {
                        // Show error message
                        const errorMessage = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to change password. Please try again.';
                        $('#changePasswordAlert').removeClass('d-none').text(errorMessage);
                    },
                    complete: function() {
                        // Hide loading spinner
                        $('#changePasswordSubmit').attr('disabled', false);
                        $('#changePasswordSubmit .spinner-border').addClass('d-none');
                    }
                });
            });
            
            // Logout
            $('#logoutBtn').click(function() {
                localStorage.removeItem('token');
                localStorage.removeItem('name');
                localStorage.removeItem('userId');
                localStorage.removeItem('role');
                window.location.href = 'login.html';
            });
            
            // Helper Functions
            function getBadgeClass(status) {
                switch (status) {
                    case 'pending':
                        return 'bg-warning';
                    case 'interview':
                        return 'bg-info';
                    case 'accepted':
                        return 'bg-success';
                    case 'rejected':
                        return 'bg-danger';
                    default:
                        return 'bg-secondary';
                }
            }
            
            function capitalizeFirstLetter(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }
            
            // Load initial data
            loadDashboardData();
        });
    </script>
</body>
</html>

