<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>My Profile - VIT Placement System</title>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
   <link rel="stylesheet" href="css/styles.css">
</head>
<body>
   <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
       <div class="container">
           <a class="navbar-brand" href="index.html">
               <i class="fas fa-graduation-cap me-2"></i>VIT Placement System
           </a>
           <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
               <span class="navbar-toggler-icon"></span>
           </button>
           <div class="collapse navbar-collapse" id="navbarNav">
               <ul class="navbar-nav me-auto">
                   <li class="nav-item">
                       <a class="nav-link" href="index.html">
                           <i class="fas fa-home me-1"></i> Home
                       </a>
                   </li>
                   <li class="nav-item">
                       <a class="nav-link" href="student-dashboard.html">
                           <i class="fas fa-tachometer-alt me-1"></i> Dashboard
                       </a>
                   </li>
                   <li class="nav-item">
                       <a class="nav-link" href="companies.html">
                           <i class="fas fa-building me-1"></i> Companies
                       </a>
                   </li>
                   <li class="nav-item">
                       <a class="nav-link active" href="profile.html">
                           <i class="fas fa-user me-1"></i> My Profile
                       </a>
                   </li>
               </ul>
               <ul class="navbar-nav">
                   <li class="nav-item dropdown">
                       <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                           <i class="fas fa-user-circle me-1"></i> <span id="username">Student</span>
                       </a>
                       <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                           <li><a class="dropdown-item" href="profile.html"><i class="fas fa-user me-2"></i>Profile</a></li>
                           <li><a class="dropdown-item" href="#" id="changePasswordBtn"><i class="fas fa-key me-2"></i>Change Password</a></li>
                           <li><hr class="dropdown-divider"></li>
                           <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                       </ul>
                   </li>
               </ul>
           </div>
       </div>
   </nav>

   <div class="container py-4">
       <div class="profile-header mb-4">
           <div class="row align-items-center">
               <div class="col-md-2 text-center">
                   <img src="/placeholder.svg?height=150&width=150" alt="Profile Picture" class="profile-avatar mb-3" id="profileImage">
               </div>
               <div class="col-md-7 profile-info">
                   <h2 id="fullName">Student Name</h2>
                   <p class="mb-1" id="rollNumberDisplay"><i class="fas fa-id-card me-2"></i>Roll Number: <span id="rollNumber"></span></p>
                   <p class="mb-0" id="emailDisplay"><i class="fas fa-envelope me-2"></i><span id="email"></span></p>
               </div>
               <div class="col-md-3 text-md-end mt-3 mt-md-0">
                   <button class="btn btn-primary mb-2" id="editProfileBtn">
                       <i class="fas fa-edit me-2"></i>Edit Profile
                   </button>
                   <button class="btn btn-outline-primary" id="uploadPhotoBtn">
                       <i class="fas fa-camera me-2"></i>Upload Photo
                   </button>
               </div>
           </div>
       </div>

       <div class="row">
           <div class="col-lg-4 mb-4">
               <!-- Contact Information -->
               <div class="card h-100">
                   <div class="card-header">
                       <h5 class="mb-0"><i class="fas fa-address-card me-2"></i>Contact Information</h5>
                   </div>
                   <div class="card-body">
                       <div class="mb-3">
                           <label class="form-label text-muted">Phone</label>
                           <p class="mb-0" id="phone"><i class="fas fa-phone me-2"></i>Not provided</p>
                       </div>
                       <div class="mb-3">
                           <label class="form-label text-muted">Email</label>
                           <p class="mb-0" id="emailInfo"><i class="fas fa-envelope me-2"></i>Not provided</p>
                       </div>
                       <div>
                           <label class="form-label text-muted">Address</label>
                           <p class="mb-0" id="address"><i class="fas fa-map-marker-alt me-2"></i>Not provided</p>
                       </div>
                   </div>
               </div>
           </div>

           <div class="col-lg-8 mb-4">
               <!-- Academic Information -->
               <div class="card h-100">
                   <div class="card-header">
                       <h5 class="mb-0"><i class="fas fa-graduation-cap me-2"></i>Academic Information</h5>
                   </div>
                   <div class="card-body">
                       <div class="row">
                           <div class="col-md-6 mb-3">
                               <label class="form-label text-muted">Course</label>
                               <p class="mb-0" id="course"><i class="fas fa-book me-2"></i>Not provided</p>
                           </div>
                           <div class="col-md-6 mb-3">
                               <label class="form-label text-muted">Branch</label>
                               <p class="mb-0" id="branch"><i class="fas fa-code-branch me-2"></i>Not provided</p>
                           </div>
                       </div>
                       <div class="row">
                           <div class="col-md-6 mb-3">
                               <label class="form-label text-muted">Year</label>
                               <p class="mb-0" id="year"><i class="fas fa-calendar-alt me-2"></i>Not provided</p>
                           </div>
                           <div class="col-md-6 mb-3">
                               <label class="form-label text-muted">CGPA</label>
                               <p class="mb-0" id="cgpa"><i class="fas fa-star me-2"></i>Not provided</p>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>

       <div class="row">
           <div class="col-12 mb-4">
               <!-- Skills -->
               <div class="card">
                   <div class="card-header d-flex justify-content-between align-items-center">
                       <h5 class="mb-0"><i class="fas fa-tools me-2"></i>Skills</h5>
                       <button class="btn btn-sm btn-primary" id="addSkillBtn">
                           <i class="fas fa-plus me-1"></i>Add Skill
                       </button>
                   </div>
                   <div class="card-body">
                       <div id="skillsContainer">
                           <!-- Skills will be dynamically added here -->
                           <div class="text-center py-3 text-muted" id="noSkillsMessage">
                               <i class="fas fa-info-circle fa-2x mb-3"></i>
                               <p>No skills added yet. Click "Add Skill" to add your skills.</p>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>

       <div class="row">
           <div class="col-12 mb-4">
               <!-- Education -->
               <div class="card">
                   <div class="card-header d-flex justify-content-between align-items-center">
                       <h5 class="mb-0"><i class="fas fa-university me-2"></i>Education</h5>
                       <button class="btn btn-sm btn-primary" id="addEducationBtn">
                           <i class="fas fa-plus me-1"></i>Add Education
                       </button>
                   </div>
                   <div class="card-body">
                       <div id="educationContainer">
                           <!-- Education entries will be dynamically added here -->
                           <div class="text-center py-3 text-muted" id="noEducationMessage">
                               <i class="fas fa-info-circle fa-2x mb-3"></i>
                               <p>No education details added yet. Click "Add Education" to add your educational background.</p>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>

       <div class="row">
           <div class="col-12 mb-4">
               <!-- Projects -->
               <div class="card">
                   <div class="card-header d-flex justify-content-between align-items-center">
                       <h5 class="mb-0"><i class="fas fa-project-diagram me-2"></i>Projects</h5>
                       <button class="btn btn-sm btn-primary" id="addProjectBtn">
                           <i class="fas fa-plus me-1"></i>Add Project
                       </button>
                   </div>
                   <div class="card-body">
                       <div id="projectsContainer">
                           <!-- Projects will be dynamically added here -->
                           <div class="text-center py-3 text-muted" id="noProjectsMessage">
                               <i class="fas fa-info-circle fa-2x mb-3"></i>
                               <p>No projects added yet. Click "Add Project" to add your projects.</p>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>

       <div class="row">
           <div class="col-12 mb-4">
               <!-- Resume -->
               <div class="card">
                   <div class="card-header d-flex justify-content-between align-items-center">
                       <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Resume</h5>
                       <button class="btn btn-sm btn-primary" id="uploadResumeBtn">
                           <i class="fas fa-upload me-1"></i>Upload Resume
                       </button>
                   </div>
                   <div class="card-body">
                       <div id="resumeContainer">
                           <!-- Resume details will be shown here -->
                           <div class="text-center py-3 text-muted" id="noResumeMessage">
                               <i class="fas fa-info-circle fa-2x mb-3"></i>
                               <p>No resume uploaded yet. Click "Upload Resume" to upload your resume.</p>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>
   </div>

   <!-- Edit Profile Modal -->
   <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
       <div class="modal-dialog modal-lg">
           <div class="modal-content">
               <div class="modal-header">
                   <h5 class="modal-title" id="editProfileModalLabel">
                       <i class="fas fa-edit me-2"></i>Edit Profile
                   </h5>
                   <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                   <div id="editProfileAlert" class="alert alert-danger d-none"></div>
                   <form id="editProfileForm">
                       <div class="row">
                           <div class="col-md-6 mb-3">
                               <label for="editFirstName" class="form-label">First Name</label>
                               <input type="text" class="form-control" id="editFirstName" name="firstName" required>
                           </div>
                           <div class="col-md-6 mb-3">
                               <label for="editLastName" class="form-label">Last Name</label>
                               <input type="text" class="form-control" id="editLastName" name="lastName" required>
                           </div>
                       </div>
                       <div class="row">
                           <div class="col-md-6 mb-3">
                               <label for="editPhone" class="form-label">Phone</label>
                               <input type="tel" class="form-control" id="editPhone" name="phone" required pattern="[0-9]{10}">
                               <div class="form-text">Please enter a valid 10-digit phone number.</div>
                           </div>
                           <div class="col-md-6 mb-3">
                               <label for="editCgpa" class="form-label">CGPA</label>
                               <input type="number" class="form-control" id="editCgpa" name="cgpa" required min="0" max="10" step="0.01">
                               <div class="form-text">CGPA must be between 0 and 10.</div>
                           </div>
                       </div>
                       <div class="mb-3">
                           <label for="editAddress" class="form-label">Address</label>
                           <textarea class="form-control" id="editAddress" name="address" rows="3" required></textarea>
                       </div>
                   </form>
               </div>
               <div class="modal-footer">
                   <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                   <button type="button" class="btn btn-primary" id="saveProfileBtn">
                       <span class="spinner-border spinner-border-sm d-none me-2" role="status" aria-hidden="true"></span>
                       Save Changes
                   </button>
               </div>
           </div>
       </div>
   </div>

   <!-- Add Skill Modal -->
   <div class="modal fade" id="addSkillModal" tabindex="-1" aria-labelledby="addSkillModalLabel" aria-hidden="true">
       <div class="modal-dialog">
           <div class="modal-content">
               <div class="modal-header">
                   <h5 class="modal-title" id="addSkillModalLabel">
                       <i class="fas fa-plus me-2"></i>Add Skill
                   </h5>
                   <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                   <form id="skillForm">
                       <div class="mb-3">
                           <label for="skillName" class="form-label">Skill Name</label>
                           <input type="text" class="form-control" id="skillName" name="skillName" required>
                       </div>
                   </form>
               </div>
               <div class="modal-footer">
                   <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                   <button type="button" class="btn btn-primary" id="saveSkillBtn">Add Skill</button>
               </div>
           </div>
       </div>
   </div>

   <!-- Add Education Modal -->
   <div class="modal fade" id="addEducationModal" tabindex="-1" aria-labelledby="addEducationModalLabel" aria-hidden="true">
       <div class="modal-dialog">
           <div class="modal-content">
               <div class="modal-header">
                   <h5 class="modal-title" id="addEducationModalLabel">
                       <i class="fas fa-plus me-2"></i>Add Education
                   </h5>
                   <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                   <form id="educationForm">
                       <div class="mb-3">
                           <label for="degree" class="form-label">Degree/Certificate</label>
                           <input type="text" class="form-control" id="degree" name="degree" required>
                       </div>
                       <div class="mb-3">
                           <label for="institution" class="form-label">Institution</label>
                           <input type="text" class="form-control" id="institution" name="institution" required>
                       </div>
                       <div class="row">
                           <div class="col-md-6 mb-3">
                               <label for="eduYear" class="form-label">Year</label>
                               <input type="text" class="form-control" id="eduYear" name="year" required>
                           </div>
                           <div class="col-md-6 mb-3">
                               <label for="percentage" class="form-label">Percentage/CGPA</label>
                               <input type="text" class="form-control" id="percentage" name="percentage" required>
                           </div>
                       </div>
                   </form>
               </div>
               <div class="modal-footer">
                   <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                   <button type="button" class="btn btn-primary" id="saveEducationBtn">Add Education</button>
               </div>
           </div>
       </div>
   </div>

   <!-- Add Project Modal -->
   <div class="modal fade" id="addProjectModal" tabindex="-1" aria-labelledby="addProjectModalLabel" aria-hidden="true">
       <div class="modal-dialog">
           <div class="modal-content">
               <div class="modal-header">
                   <h5 class="modal-title" id="addProjectModalLabel">
                       <i class="fas fa-plus me-2"></i>Add Project
                   </h5>
                   <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                   <form id="projectForm">
                       <div class="mb-3">
                           <label for="projectTitle" class="form-label">Project Title</label>
                           <input type="text" class="form-control" id="projectTitle" name="title" required>
                       </div>
                       <div class="mb-3">
                           <label for="projectDescription" class="form-label">Description</label>
                           <textarea class="form-control" id="projectDescription" name="description" rows="3" required></textarea>
                       </div>
                       <div class="row">
                           <div class="col-md-6 mb-3">
                               <label for="projectYear" class="form-label">Year</label>
                               <input type="text" class="form-control" id="projectYear" name="year" required>
                           </div>
                           <div class="col-md-6 mb-3">
                               <label for="projectTechnologies" class="form-label">Technologies</label>
                               <input type="text" class="form-control" id="projectTechnologies" name="technologies">
                           </div>
                       </div>
                   </form>
               </div>
               <div class="modal-footer">
                   <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                   <button type="button" class="btn btn-primary" id="saveProjectBtn">Add Project</button>
               </div>
           </div>
       </div>
   </div>

   <!-- Upload Resume Modal -->
   <div class="modal fade" id="uploadResumeModal" tabindex="-1" aria-labelledby="uploadResumeModalLabel" aria-hidden="true">
       <div class="modal-dialog">
           <div class="modal-content">
               <div class="modal-header">
                   <h5 class="modal-title" id="uploadResumeModalLabel">
                       <i class="fas fa-upload me-2"></i>Upload Resume
                   </h5>
                   <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                   <form id="resumeForm">
                       <div class="mb-3">
                           <label for="resumeFile" class="form-label">Select Resume (PDF only)</label>
                           <input type="file" class="form-control" id="resumeFile" name="resumeFile" accept=".pdf" required>
                       </div>
                   </form>
               </div>
               <div class="modal-footer">
                   <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                   <button type="button" class="btn btn-primary" id="saveResumeBtn">Upload</button>
               </div>
           </div>
       </div>
   </div>

   <!-- Upload Photo Modal -->
   <div class="modal fade" id="uploadPhotoModal" tabindex="-1" aria-labelledby="uploadPhotoModalLabel" aria-hidden="true">
       <div class="modal-dialog">
           <div class="modal-content">
               <div class="modal-header">
                   <h5 class="modal-title" id="uploadPhotoModalLabel">
                       <i class="fas fa-camera me-2"></i>Upload Profile Photo
                   </h5>
                   <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                   <form id="photoForm">
                       <div class="mb-3">
                           <label for="photoFile" class="form-label">Select Photo (JPG, PNG only)</label>
                           <input type="file" class="form-control" id="photoFile" name="photoFile" accept=".jpg,.jpeg,.png" required>
                       </div>
                   </form>
               </div>
               <div class="modal-footer">
                   <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                   <button type="button" class="btn btn-primary" id="savePhotoBtn">Upload</button>
               </div>
           </div>
       </div>
   </div>

   <!-- Change Password Modal -->
   <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
       <div class="modal-dialog">
           <div class="modal-content">
               <div class="modal-header">
                   <h5 class="modal-title" id="changePasswordModalLabel">
                       <i class="fas fa-key me-2"></i>Change Password
                   </h5>
                   <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                   <div id="changePasswordAlert" class="alert alert-danger d-none"></div>
                   <form id="changePasswordForm">
                       <div class="mb-3">
                           <label for="currentPassword" class="form-label">Current Password</label>
                           <div class="input-group">
                               <span class="input-group-text"><i class="fas fa-lock"></i></span>
                               <input type="password" class="form-control" id="currentPassword" required>
                               <button class="btn btn-outline-secondary toggle-password" type="button">
                                   <i class="fas fa-eye"></i>
                               </button>
                           </div>
                       </div>
                       <div class="mb-3">
                           <label for="newPassword" class="form-label">New Password</label>
                           <div class="input-group">
                               <span class="input-group-text"><i class="fas fa-lock"></i></span>
                               <input type="password" class="form-control" id="newPassword" required minlength="6">
                               <button class="btn btn-outline-secondary toggle-password" type="button">
                                   <i class="fas fa-eye"></i>
                               </button>
                           </div>
                           <div class="form-text">Password must be at least 6 characters long.</div>
                       </div>
                       <div class="mb-3">
                           <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
                           <div class="input-group">
                               <span class="input-group-text"><i class="fas fa-lock"></i></span>
                               <input type="password" class="form-control" id="confirmNewPassword" required minlength="6">
                               <button class="btn btn-outline-secondary toggle-password" type="button">
                                   <i class="fas fa-eye"></i>
                               </button>
                           </div>
                           <div id="passwordMatchError" class="invalid-feedback">Passwords do not match.</div>
                       </div>
                   </form>
               </div>
               <div class="modal-footer">
                   <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                   <button type="button" class="btn btn-primary" id="changePasswordSubmit">
                       <span class="spinner-border spinner-border-sm d-none me-2" role="status" aria-hidden="true"></span>
                       Update Password
                   </button>
               </div>
           </div>
       </div>
   </div>

   <footer>
       <div class="container">
           <div class="row">
               <div class="col-md-4 mb-4 mb-md-0">
                   <h5 class="mb-3">VIT Placement System</h5>
                   <p class="mb-0">Connecting students with opportunities for a brighter future. The official placement portal for VIT Vellore students.</p>
               </div>
               <div class="col-md-4 mb-4 mb-md-0">
                   <h5 class="mb-3">Quick Links</h5>
                   <ul class="list-unstyled">
                       <li><a href="index.html"><i class="fas fa-angle-right me-2"></i>Home</a></li>
                       <li><a href="student-dashboard.html"><i class="fas fa-angle-right me-2"></i>Dashboard</a></li>
                       <li><a href="companies.html"><i class="fas fa-angle-right me-2"></i>Companies</a></li>
                   </ul>
               </div>
               <div class="col-md-4">
                   <h5 class="mb-3">Contact Us</h5>
                   <ul class="list-unstyled">
                       <li><i class="fas fa-map-marker-alt me-2"></i>VIT University, Vellore, Tamil Nadu - 632014</li>
                       <li><i class="fas fa-phone me-2"></i>+91 123 456 7890</li>
                       <li><i class="fas fa-envelope me-2"></i>placement@vit.ac.in</li>
                   </ul>
               </div>
           </div>
           <hr class="mt-4 mb-4" style="border-color: rgba(255,255,255,0.1);">
           <div class="text-center">
               <p class="mb-0">© 2025 VIT Placement System. All rights reserved. Developed by Devin Thakur - 23BIT0031</p>
           </div>
       </div>
   </footer>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script>
       $(document).ready(function() {
           // Check if user is logged in
           if (!localStorage.getItem('token')) {
               window.location.href = 'login.html';
           }

           // Set username in navbar
           $('#username').text(localStorage.getItem('name') || 'Student');

           // Toggle password visibility
           $('.toggle-password').click(function() {
               const passwordField = $(this).siblings('input');
               const icon = $(this).find('i');
               
               if (passwordField.attr('type') === 'password') {
                   passwordField.attr('type', 'text');
                   icon.removeClass('fa-eye').addClass('fa-eye-slash');
               } else {
                   passwordField.attr('type', 'password');
                   icon.removeClass('fa-eye-slash').addClass('fa-eye');
               }
           });

           // Load profile data
           function loadProfile() {
               
               $.ajax({
                   url: '/api/student/profile',
                   method: 'GET',
                   headers: {
                       'Authorization': 'Bearer ' + localStorage.getItem('token')
                   },
                   success: function(response) {
                       const user = response.user;
                       
                       // Update profile header
                       $('#fullName').text(user.firstName + ' ' + user.lastName);
                       $('#rollNumber').text(user.rollNumber);
                       $('#email, #emailInfo').text(user.email);
                       
                       // Update contact information
                       $('#phone').html(`<i class="fas fa-phone me-2"></i>${user.phone || 'Not provided'}`);
                       $('#address').html(`<i class="fas fa-map-marker-alt me-2"></i>${user.address || 'Not provided'}`);
                       
                       // Update academic information
                       $('#course').html(`<i class="fas fa-book me-2"></i>${user.course || 'Not provided'}`);
                       $('#branch').html(`<i class="fas fa-code-branch me-2"></i>${user.branch || 'Not provided'}`);
                       $('#year').html(`<i class="fas fa-calendar-alt me-2"></i>${user.year ? user.year + ' Year' : 'Not provided'}`);
                       $('#cgpa').html(`<i class="fas fa-star me-2"></i>${user.cgpa || 'Not provided'}`);
                       
                       // Populate edit form
                       $('#editFirstName').val(user.firstName);
                       $('#editLastName').val(user.lastName);
                       $('#editPhone').val(user.phone);
                       $('#editCgpa').val(user.cgpa);
                       $('#editAddress').val(user.address);
                       
                       // Load skills
                       if (user.skills && user.skills.length > 0) {
                           $('#noSkillsMessage').hide();
                           let skillsHtml = '';
                           user.skills.forEach(function(skill) {
                               skillsHtml += `<span class="badge bg-primary me-2 mb-2 p-2">${skill}</span>`;
                           });
                           $('#skillsContainer').html(skillsHtml);
                       } else {
                           $('#noSkillsMessage').show();
                       }
                       
                       // Load education
                       if (user.education && user.education.length > 0) {
                           $('#noEducationMessage').hide();
                           let educationHtml = '';
                           user.education.forEach(function(edu, index) {
                               educationHtml += `
                                   <div class="education-item mb-3 p-3 border rounded">
                                       <div class="d-flex justify-content-between">
                                           <h5 class="mb-1">${edu.degree}</h5>
                                           <span class="text-muted">${edu.year}</span>
                                       </div>
                                       <p class="mb-1"><i class="fas fa-university me-2"></i>${edu.institution}</p>
                                       <p class="mb-0 text-muted"><i class="fas fa-percentage me-2"></i>Percentage/CGPA: ${edu.percentage}</p>
                                       ${index < user.education.length - 1 ? '<hr>' : ''}
                                   </div>
                               `;
                           });
                           $('#educationContainer').html(educationHtml);
                       } else {
                           $('#noEducationMessage').show();
                       }
                       
                       // Load projects
                       if (user.projects && user.projects.length > 0) {
                           $('#noProjectsMessage').hide();
                           let projectsHtml = '';
                           user.projects.forEach(function(project, index) {
                               projectsHtml += `
                                   <div class="project-item mb-3 p-3 border rounded">
                                       <div class="d-flex justify-content-between">
                                           <h5 class="mb-1">${project.title}</h5>
                                           <span class="text-muted">${project.year}</span>
                                       </div>
                                       <p class="mb-1">${project.description}</p>
                                       <p class="mb-0 text-muted"><i class="fas fa-code me-2"></i>Technologies: ${project.technologies || 'Not specified'}</p>
                                       ${index < user.projects.length - 1 ? '<hr>' : ''}
                                   </div>
                               `;
                           });
                           $('#projectsContainer').html(projectsHtml);
                       } else {
                           $('#noProjectsMessage').show();
                       }
                       
                       // Load resume
                       if (user.resume) {
                           $('#noResumeMessage').hide();
                           const resumeHtml = `
                               <div class="d-flex justify-content-between align-items-center">
                                   <div>
                                       <h5 class="mb-1">${user.resume.filename}</h5>
                                       <p class="mb-0 text-muted">Uploaded on: ${new Date(user.resume.uploadDate).toLocaleDateString()}</p>
                                   </div>
                                   <div>
                                       <a href="#" class="btn btn-sm btn-outline-primary me-2"><i class="fas fa-eye me-1"></i>View</a>
                                       <a href="#" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash me-1"></i>Delete</a>
                                   </div>
                               </div>
                           `;
                           $('#resumeContainer').html(resumeHtml);
                       } else {
                           $('#noResumeMessage').show();
                       }
                   },
                   error: function(xhr) {
                       console.error('Failed to load profile:', xhr.responseJSON);
                       alert('Failed to load profile. Please try again later.');
                   }
               });
           }

           // Load profile on page load
           loadProfile();

           // Edit Profile
           $('#editProfileBtn').click(function() {
               $('#editProfileModal').modal('show');
           });

           $('#saveProfileBtn').click(function() {
               const firstName = $('#editFirstName').val();
               const lastName = $('#editLastName').val();
               const phone = $('#editPhone').val();
               const cgpa = $('#editCgpa').val();
               const address = $('#editAddress').val();
               
               // Show loading spinner
               $(this).attr('disabled', true);
               $(this).find('.spinner-border').removeClass('d-none');
               $('#editProfileAlert').addClass('d-none');
               
               $.ajax({
                   url: '/api/student/profile',
                   method: 'PUT',
                   headers: {
                       'Authorization': 'Bearer ' + localStorage.getItem('token')
                   },
                   contentType: 'application/json',
                   data: JSON.stringify({
                       firstName: firstName,
                       lastName: lastName,
                       phone: phone,
                       cgpa: cgpa,
                       address: address
                   }),
                   success: function(response) {
                       // Update localStorage with new name
                       localStorage.setItem('name', firstName + ' ' + lastName);
                       $('#username').text(firstName + ' ' + lastName);
                       
                       // Reload profile data
                       loadProfile();
                       
                       // Close modal
                       $('#editProfileModal').modal('hide');
                       
                       // Show success message
                       alert('Profile updated successfully!');
                   },
                   error: function(xhr) {
                       // Show error message
                       const errorMessage = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to update profile. Please try again.';
                       $('#editProfileAlert').removeClass('d-none').text(errorMessage);
                   },
                   complete: function() {
                       // Hide loading spinner
                       $('#saveProfileBtn').attr('disabled', false);
                       $('#saveProfileBtn .spinner-border').addClass('d-none');
                   }
               });
           });

           // Add Skill
           $('#addSkillBtn').click(function() {
               $('#addSkillModal').modal('show');
           });

           $('#saveSkillBtn').click(function() {
               const skillName = $('#skillName').val();
               
               if (!skillName) {
                   alert('Please enter a skill name');
                   return;
               }
               
               // In a real app, this would make an AJAX call to save the skill
               // For now, we'll just update the UI
               
               // Get current skills
               let skills = [];
               if (localStorage.getItem('skills')) {
                   skills = JSON.parse(localStorage.getItem('skills'));
               }
               
               // Add new skill
               skills.push(skillName);
               
               // Save to localStorage
               localStorage.setItem('skills', JSON.stringify(skills));
               
               // Update UI
               $('#noSkillsMessage').hide();
               let skillsHtml = '';
               skills.forEach(function(skill) {
                   skillsHtml += `<span class="badge bg-primary me-2 mb-2 p-2">${skill}</span>`;
               });
               $('#skillsContainer').html(skillsHtml);
               
               // Close modal and reset form
               $('#skillName').val('');
               $('#addSkillModal').modal('hide');
           });

           // Add Education
           $('#addEducationBtn').click(function() {
               $('#addEducationModal').modal('show');
           });

           $('#saveEducationBtn').click(function() {
               const degree = $('#degree').val();
               const institution = $('#institution').val();
               const year = $('#eduYear').val();
               const percentage = $('#percentage').val();
               
               if (!degree || !institution || !year || !percentage) {
                   alert('Please fill all required fields');
                   return;
               }
               
               // In a real app, this would make an AJAX call to save the education
               // For now, we'll just update the UI
               
               // Get current education
               let education = [];
               if (localStorage.getItem('education')) {
                   education = JSON.parse(localStorage.getItem('education'));
               }
               
               // Add new education
               education.push({
                   degree: degree,
                   institution: institution,
                   year: year,
                   percentage: percentage
               });
               
               // Save to localStorage
               localStorage.setItem('education', JSON.stringify(education));
               
               // Update UI
               $('#noEducationMessage').hide();
               let educationHtml = '';
               education.forEach(function(edu, index) {
                   educationHtml += `
                       <div class="education-item mb-3 p-3 border rounded">
                           <div class="d-flex justify-content-between">
                               <h5 class="mb-1">${edu.degree}</h5>
                               <span class="text-muted">${edu.year}</span>
                           </div>
                           <p class="mb-1"><i class="fas fa-university me-2"></i>${edu.institution}</p>
                           <p class="mb-0 text-muted"><i class="fas fa-percentage me-2"></i>Percentage/CGPA: ${edu.percentage}</p>
                           ${index < education.length - 1 ? '<hr>' : ''}
                       </div>
                   `;
               });
               $('#educationContainer').html(educationHtml);
               
               // Close modal and reset form
               $('#degree, #institution, #eduYear, #percentage').val('');
               $('#addEducationModal').modal('hide');
           });

           // Add Project
           $('#addProjectBtn').click(function() {
               $('#addProjectModal').modal('show');
           });

           $('#saveProjectBtn').click(function() {
               const title = $('#projectTitle').val();
               const description = $('#projectDescription').val();
               const year = $('#projectYear').val();
               const technologies = $('#projectTechnologies').val();
               
               if (!title || !description || !year) {
                   alert('Please fill all required fields');
                   return;
               }
               
               // In a real app, this would make an AJAX call to save the project
               // For now, we'll just update the UI
               
               // Get current projects
               let projects = [];
               if (localStorage.getItem('projects')) {
                   projects = JSON.parse(localStorage.getItem('projects'));
               }
               
               // Add new project
               projects.push({
                   title: title,
                   description: description,
                   year: year,
                   technologies: technologies
               });
               
               // Save to localStorage
               localStorage.setItem('projects', JSON.stringify(projects));
               
               // Update UI
               $('#noProjectsMessage').hide();
               let projectsHtml = '';
               projects.forEach(function(project, index) {
                   projectsHtml += `
                       <div class="project-item mb-3 p-3 border rounded">
                           <div class="d-flex justify-content-between">
                               <h5 class="mb-1">${project.title}</h5>
                               <span class="text-muted">${project.year}</span>
                           </div>
                           <p class="mb-1">${project.description}</p>
                           <p class="mb-0 text-muted"><i class="fas fa-code me-2"></i>Technologies: ${project.technologies || 'Not specified'}</p>
                           ${index < projects.length - 1 ? '<hr>' : ''}
                       </div>
                   `;
               });
               $('#projectsContainer').html(projectsHtml);
               
               // Close modal and reset form
               $('#projectTitle, #projectDescription, #projectYear, #projectTechnologies').val('');
               $('#addProjectModal').modal('hide');
           });

           // Upload Resume
           $('#uploadResumeBtn').click(function() {
               $('#uploadResumeModal').modal('show');
           });

           $('#saveResumeBtn').click(function() {
               const resumeFile = $('#resumeFile')[0].files[0];
               
               if (!resumeFile) {
                   alert('Please select a file');
                   return;
               }
               
               // In a real app, this would upload the file to the server
               // For now, we'll just update the UI
               
               // Update UI
               $('#noResumeMessage').hide();
               const resumeHtml = `
                   <div class="d-flex justify-content-between align-items-center">
                       <div>
                           <h5 class="mb-1">${resumeFile.name}</h5>
                           <p class="mb-0 text-muted">Uploaded on: ${new Date().toLocaleDateString()}</p>
                       </div>
                       <div>
                           <a href="#" class="btn btn-sm btn-outline-primary me-2"><i class="fas fa-eye me-1"></i>View</a>
                           <a href="#" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash me-1"></i>Delete</a>
                       </div>
                   </div>
               `;
               $('#resumeContainer').html(resumeHtml);
               
               // Close modal and reset form
               $('#resumeFile').val('');
               $('#uploadResumeModal').modal('hide');
           });

           // Upload Photo
           $('#uploadPhotoBtn').click(function() {
               $('#uploadPhotoModal').modal('show');
           });

           $('#savePhotoBtn').click(function() {
               const photoFile = $('#photoFile')[0].files[0];
               
               if (!photoFile) {
                   alert('Please select a file');
                   return;
               }
               
               // In a real app, this would upload the file to the server
               // For now, we'll just update the UI using FileReader
               
               const reader = new FileReader();
               reader.onload = function(e) {
                   $('#profileImage').attr('src', e.target.result);
               };
               reader.readAsDataURL(photoFile);
               
               // Close modal and reset form
               $('#photoFile').val('');
               $('#uploadPhotoModal').modal('hide');
           });

           // Change Password
           $('#changePasswordBtn').click(function() {
               $('#changePasswordModal').modal('show');
           });

           $('#changePasswordSubmit').click(function() {
               const currentPassword = $('#currentPassword').val();
               const newPassword = $('#newPassword').val();
               const confirmNewPassword = $('#confirmNewPassword').val();
               
               // Validate passwords match
               if (newPassword !== confirmNewPassword) {
                   $('#confirmNewPassword').addClass('is-invalid');
                   $('#passwordMatchError').show();
                   return;
               } else {
                   $('#confirmNewPassword').removeClass('is-invalid');
                   $('#passwordMatchError').hide();
               }
               
               // Show loading spinner
               $(this).attr('disabled', true);
               $(this).find('.spinner-border').removeClass('d-none');
               $('#changePasswordAlert').addClass('d-none');
               
               // AJAX request to change password
               $.ajax({
                   url: '/api/auth/change-password',
                   method: 'POST',
                   headers: {
                       'Authorization': 'Bearer ' + localStorage.getItem('token')
                   },
                   contentType: 'application/json',
                   data: JSON.stringify({
                       currentPassword: currentPassword,
                       newPassword: newPassword
                   }),
                   success: function() {
                       alert('Password changed successfully!');
                       
                       // Reset form
                       $('#currentPassword, #newPassword, #confirmNewPassword').val('');
                       
                       // Close modal
                       $('#changePasswordModal').modal('hide');
                   },
                   error: function(xhr) {
                       // Show error message
                       const errorMessage = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to change password. Please try again.';
                       $('#changePasswordAlert').removeClass('d-none').text(errorMessage);
                   },
                   complete: function() {
                       // Hide loading spinner
                       $('#changePasswordSubmit').attr('disabled', false);
                       $('#changePasswordSubmit .spinner-border').addClass('d-none');
                   }
               });
           });

           // Logout functionality
           $('#logoutBtn').click(function(e) {
               e.preventDefault();
               
               // Clear localStorage
               localStorage.removeItem('token');
               localStorage.removeItem('name');
               localStorage.removeItem('userId');
               localStorage.removeItem('role');
               
               // Redirect to login page
               window.location.href = 'login.html';
           });
       });
   </script>
</body>
</html>